#!/bin/sh
set -e

echo "Проверяем, нужно ли инициализировать базу данных..."

# Пытаемся выполнить простой SQL-запрос через консольное подключение к PostgreSQL,
# чтобы понять, есть ли уже таблицы. Используем psql, который должен быть установлен.
# Если psql не установлен, можно использовать другой метод: попытаться выполнить install и игнорировать ошибки.
# Проще всего просто всегда выполнять install --force, если таблиц нет.
# Но safest: пробуем выполнить команду status, если падает — значит БД чистая.

if yarn nocobase db:auth; then
  echo "База уже инициализирована, запускаем приложение..."
else
  echo "База пустая, выполняем установку..."
  yarn nocobase install --force
fi

# Запускаем само приложение
exec yarn start
